profile: segd21
description: "Minimal SEG-D 2.1 layout for YAML-driven reader"

blocks:
  general_header1:
    size: 32
    fields:
      - {name: file_number, offset: 0, type: u16_be}
      - {name: format_code, offset: 2, type: u8}
      - {name: manufacturer_code, offset: 3, type: u8}
      - {name: general_header_blocks, offset: 4, type: u8}
      - {name: channel_sets, offset: 5, type: u8}
      - {name: samples_per_trace, offset: 6, type: u16_be}
      - {name: sample_interval_us, offset: 8, type: u16_be}
      - {name: extended_header_blocks, offset: 10, type: u16_be}
      - {name: external_header_blocks, offset: 12, type: u16_be}
      - {name: demux_header_bytes, offset: 14, type: u16_be}
      - {name: trace_extension_bytes, offset: 16, type: u16_be}
      - {name: record_length_bytes, offset: 18, type: u16_be}
      - {name: _padding0, offset: 20, type: "bytes[12]"}

  channel_set_header:
    size: 24
    fields:
      - {name: channel_set_number, offset: 0, type: u8}
      - {name: trace_count, offset: 1, type: u8}
      - {name: samples_per_trace, offset: 2, type: u16_be}
      - {name: sample_interval_us, offset: 4, type: u16_be}
      - {name: data_format_code, offset: 6, type: u16_be}
      - {name: trace_header_bytes, offset: 8, type: u16_be}
      - {name: trace_extension_bytes, offset: 10, type: u16_be}
      - {name: first_trace_sequence, offset: 12, type: u32_be}
      - {name: last_trace_sequence, offset: 16, type: u32_be}
      - {name: _padding1, offset: 20, type: "bytes[4]"}

  demux_header:
    size: 16
    fields:
      - {name: trace_sequence, offset: 0, type: u32_be}
      - {name: channel_set_number, offset: 4, type: u16_be}
      - {name: trace_in_set, offset: 6, type: u16_be}
      - {name: samples_in_trace, offset: 8, type: u16_be}
      - {name: first_sample_time_us, offset: 10, type: u16_be}
      - {name: reserved, offset: 12, type: "bytes[4]"}

record_layout:
  general_headers:
    - {block: general_header1, count: 1}
  channel_sets:
    block: channel_set_header
    count_field: general_header1.channel_sets
    trace_count_field: trace_count
    samples_field: samples_per_trace
    sample_interval_field: sample_interval_us
    format_field: data_format_code
    trace_header_bytes_field: trace_header_bytes
    trace_extension_bytes_field: trace_extension_bytes
  trace_headers:
    demux_block: demux_header
    extension_blocks: []
  extended_headers:
    block_size: 32
    count_field: general_header1.extended_header_blocks
  external_headers:
    block_size: 32
    count_field: general_header1.external_header_blocks
  data_samples:
    byte_order: big

